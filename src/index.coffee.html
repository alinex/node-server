<!DOCTYPE html>
<html>
<head>
  <title>index.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "home/alex/github/node-server/src/index.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#startup-alinex-server">Startup Alinex Server</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#data-container">Data container</a>
      </div>

      <div class="heading h2">
        <a href="#define-singleton-instance">Define singleton instance</a>
      </div>

      <div class="heading h2">
        <a href="#initialization">Initialization</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-server" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="startup-alinex-server">
  <h1>
    <a href="#startup-alinex-server" name="startup-alinex-server" class="pilcrow"></a>
Startup Alinex Server
  </h1>
</div>
<p>This file is used to start the whole system. It will start as single server
or cluster server depending on the <code>NODE_ENV</code> setting.</p>
<p>For productive system the server starts as cluster to use the power of
multi core architectures. It is not aimed for multi server cluster, this have
to be set up on top.</p>
<p>To configure the system use the <code>config/server</code> files.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'server'</span>)
fspath = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">config = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-config'</span>
async = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-async'</span>
fs = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-fs'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="data-container">
  <h2>
    <a href="#data-container" name="data-container" class="pilcrow"></a>
Data container
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">types = [] <span class="hljs-comment"># list of possible server types</span>
conf = <span class="hljs-literal">null</span> <span class="hljs-comment"># configuration</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="define-singleton-instance">
  <h2>
    <a href="#define-singleton-instance" name="define-singleton-instance" class="pilcrow"></a>
Define singleton instance
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-built_in">module</span>.exports = server =

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="initialization">
  <h2>
    <a href="#initialization" name="initialization" class="pilcrow"></a>
Initialization
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>set the modules config paths and validation schema</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">setup</span>: async.once (cb) -&gt;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>set module search path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    config.register <span class="hljs-literal">false</span>, fspath.dirname __dirname
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>add schema for module's configuration</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    config.setSchema <span class="hljs-string">'/server'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./configSchema'</span>), cb

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>set the modules config paths, validation schema and initialize the configuration</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">init</span>: async.once (cb) -&gt;
    debug <span class="hljs-string">"initialize server"</span>
    async.parallel [
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>load types</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      (cb) -&gt; fs.find __dirname,
        <span class="hljs-attribute">type</span>: <span class="hljs-string">'dir'</span>
        <span class="hljs-attribute">mindepth</span>: <span class="hljs-number">1</span>
        <span class="hljs-attribute">maxdepth</span>: <span class="hljs-number">1</span>
        <span class="hljs-attribute">exclude</span>: <span class="hljs-string">'doc'</span>
      , <span class="hljs-function"><span class="hljs-params">(err, list)</span> -&gt;</span>
        types = list?.map (e) -&gt; fspath.basename e, fspath.extname e
        cb err
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>set module search path and init config</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      (cb) -&gt; server.setup (err) -&gt;
        <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
        config.init cb
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>setup log directory</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      (cb) -&gt; fs.mkdir __dirname + <span class="hljs-string">'/../var/log'</span>, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
        <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> err.code <span class="hljs-keyword">is</span> <span class="hljs-string">'EEXIST'</span>
        cb()
    ], <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>initialize individual servers</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      conf = config.get <span class="hljs-string">'server'</span>
      async.each types, <span class="hljs-function"><span class="hljs-params">(type, cb)</span> -&gt;</span>
        <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">if</span> server[type]? <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> conf[type]?
        debug <span class="hljs-string">"initialize <span class="hljs-subst">#{type}</span> server part"</span>
        server.http = <span class="hljs-built_in">require</span> <span class="hljs-string">"./<span class="hljs-subst">#{type}</span>/index"</span>
        server.http.init cb
      , cb

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
